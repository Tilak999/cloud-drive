<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cloud Drive Web UI</title>
        <script src="//unpkg.com/alpinejs" defer></script>
        <script src="/socket.io/socket.io.js"></script>
        <link href="/css/style.css" rel="stylesheet" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
            crossorigin="anonymous"
        />
        <script>
            window.socket = io();
            document.addEventListener("alpine:init", () => {
                Alpine.store("loading", true);
                Alpine.store("history", {
                    nodes: [
                        {
                            name: "root",
                            path: "gfs:/",
                        },
                    ],
                    push(file) {
                        this.nodes.push(file);
                        window.socket.emit("get-list", file);
                        Alpine.store("loading", true);
                    },
                    pop() {
                        node = this.nodes.pop();
                        window.socket.emit("get-list", this.getLastNode());
                        Alpine.store("loading", true);
                        return node;
                    },
                    getLastNode() {
                        return this.nodes[this.nodes.length - 1];
                    },
                });

                Alpine.store("files", []);
                window.socket.on("list", (data) => {
                    console.log(data);
                    Alpine.store("files", data.files);
                    Alpine.store("loading", false);
                });
            });
        </script>
    </head>
    <body>
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Cloud Drive</a>
            </div>
        </nav>
        <div class="container-fluid" x-data>
            <div class="card my-4">
                <div class="card-header">
                    <template x-if="$store.loading">
                        <div class="spinner-border spinner-border-sm mr-2">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </template>
                    <span x-text="$store.history.getLastNode().name"></span>
                </div>
                <template x-if="!$store.loading">
                    <ul class="list-group list-group-flush">
                        <li
                            class="list-group-item"
                            @click="$store.history.pop()"
                        >
                            Go Back
                        </li>
                        <template x-for="file in $store.files">
                            <li class="list-group-item d-flex">
                                <div
                                    class="flex-grow-1"
                                    @click="file.isDirectory ? $store.history.push(file) : window.open(file.webViewLink)"
                                >
                                    <img :src="file.iconLink" />
                                    <span x-text="file.name"></span>
                                </div>
                                <div
                                    @click="window.socket.emit('delete', file)"
                                    class="mx-2"
                                >
                                    delete
                                </div>
                                <div
                                    data-bs-toggle="modal"
                                    data-bs-target="#exampleModal"
                                    @click="$store.fileInfo = file"
                                >
                                    info
                                </div>
                            </li>
                        </template>
                    </ul>
                </template>
            </div>
        </div>

        <!-- Modal-Start -->
        <div class="modal fade" id="exampleModal" x-data>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 class="modal-title">Information</h6>
                        <button
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <ul class="list-group">
                            <li class="list-group-item">
                                <div class="bold mb-1">Name:</div>
                                <div
                                    x-text="$store.fileInfo?.name"
                                    style="word-break: break-all"
                                ></div>
                            </li>
                            <li class="list-group-item">
                                <div class="bold mb-1">Create Date:</div>
                                <div x-text="$store.fileInfo?.createDate"></div>
                            </li>
                            <li class="list-group-item">
                                <div class="bold mb-1">File Size:</div>
                                <div x-text="$store.fileInfo?.fileSize"></div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal-End -->
    </body>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"
    ></script>
</html>
