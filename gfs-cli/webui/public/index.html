<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cloud Drive Web UI</title>
        <script src="//unpkg.com/alpinejs" defer></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <link href="/css/style.css" rel="stylesheet" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <script>
            document.addEventListener("alpine:init", () => {
                window.pathHistory = [];
                Alpine.store("loading", true);
                getList("gfs:/");
            });

            function getList(path) {
                Alpine.store("loading", true);
                axios.post("/list", { path }).then((resp) => {
                    Alpine.store("loading", false);
                    Alpine.store("files", resp.data.files);
                });
            }

            function gotoPage(path) {
                if (path) window.pathHistory.push(path);
                getList(path);
            }

            function gotoPrevPage() {
                console.log("stack:" + window.pathHistory);
                window.pathHistory.pop();
                const path = window.pathHistory[window.pathHistory.length - 1];
                getList(path);
            }
        </script>
    </head>
    <body>
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Cloud Drive</a>
            </div>
        </nav>
        <div class="container-fluid" x-data>
            <div class="card my-4">
                <div class="card-header">
                    <template x-if="$store.loading">
                        <div class="spinner-border spinner-border-sm mr-2">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </template>
                </div>
                <template x-if="!$store.loading">
                    <ul class="list-group list-group-flush">
                        <template x-if="window.pathHistory.length > 0">
                            <li class="list-group-item" @click="gotoPrevPage()">
                                Go Back
                            </li>
                        </template>
                        <template x-for="file in $store.files">
                            <li class="list-group-item d-flex">
                                <template x-if="file.webViewLink">
                                    <a
                                        :href="file.webViewLink"
                                        target="_blank"
                                        class="flex-grow-1"
                                    >
                                        <img :src="file.iconLink" />
                                        <span x-text="file.name"></span>
                                    </a>
                                </template>
                                <template x-if="!file.webViewLink">
                                    <div
                                        class="flex-grow-1"
                                        @click="gotoPage(file.path)"
                                    >
                                        <img :src="file.iconLink" />
                                        <span x-text="file.name"></span>
                                    </div>
                                </template>
                                <div class="mx-2">delete</div>
                                <div
                                    data-bs-toggle="modal"
                                    data-bs-target="#exampleModal"
                                    @click="$store.fileInfo = file"
                                >
                                    info
                                </div>
                            </li>
                        </template>
                    </ul>
                </template>
            </div>
        </div>

        <!-- Modal-Start -->
        <div class="modal fade" id="exampleModal" x-data>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 class="modal-title">Information</h6>
                        <button
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <ul class="list-group">
                            <li class="list-group-item">
                                <div class="bold mb-1">Name:</div>
                                <div
                                    x-text="$store.fileInfo?.name"
                                    style="word-break: break-all"
                                ></div>
                            </li>
                            <li class="list-group-item">
                                <div class="bold mb-1">Create Date:</div>
                                <div x-text="$store.fileInfo?.createDate"></div>
                            </li>
                            <li class="list-group-item">
                                <div class="bold mb-1">File Size:</div>
                                <div x-text="$store.fileInfo?.fileSize"></div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal-End -->
    </body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
</html>
